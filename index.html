<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade and Attendance Calculator</title>
    <script>
        function readFile(input, callback) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = function() {
                callback(reader.result);
            }
            reader.readAsText(file);
        }

        async function calculateChanges() {
            const gradesInput = document.getElementById('gradesInput').value;
            const attendanceInput = document.getElementById('attendanceInput').value;

            const gradesFileInput = document.getElementById('gradesFile');
            const attendanceFileInput = document.getElementById('attendanceFile');

            let gradeContents = '';
            let attendanceContents = '';

            readFile(gradesFileInput, function(gradesResult) {
                gradeContents = gradesResult;

                readFile(attendanceFileInput, function(attendanceResult) {
                    attendanceContents = attendanceResult;

                    const grades = stringToGrades(gradeContents);
                    const attendance = stringToAttendance(attendanceContents);

                    let gradeStats = calculateStats(grades.flat());
                    let attendanceStats = calculateStats(attendance, false);

                    let attendanceChange = calculateDrasticChange(attendanceStats, Number(attendanceInput));
                    let gradeChange = 0;
                    let count = 0;
                    for (let gradeInput of gradesInput.split(',')) {
                        count++;
                        gradeChange += calculateDrasticChange(gradeStats, Number(gradeInput), true);
                    }
                    gradeChange /= count;

                    document.getElementById('gradeChange').innerText = 'Grade Change: ' + gradeChange;
                    document.getElementById('attendanceChange').innerText = 'Attendance Change: ' + attendanceChange;
                });
            });
        }
    </script>
</head>
<body>
    <h1>Grade and Attendance Calculator</h1>
    <form onsubmit="event.preventDefault(); calculateChanges();">
        <label for="gradesInput">Enter grades (separated by commas):</label>
        <input type="text" id="gradesInput" name="gradesInput" required>
        <br>
        <label for="attendanceInput">Enter number of tardies:</label>
        <input type="number" id="attendanceInput" name="attendanceInput" required>
        <br>
        <label for="gradesFile">Upload grades file:</label>
        <input type="file" id="gradesFile" name="gradesFile" accept=".txt" required>
        <br>
        <label for="attendanceFile">Upload attendance file:</label>
        <input type="file" id="attendanceFile" name="attendanceFile" accept=".txt" required>
        <br>
        <button type="submit">Calculate</button>
    </form>
    <p id="gradeChange"></p>
    <p id="attendanceChange"></p>
    <script src="functions.js"></script>
</body>
</html>
